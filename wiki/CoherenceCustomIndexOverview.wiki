#summary Coherence Custom index API overview

Before you start with custom index I suggest you to study this topic in Coherence documentation - [http://download.oracle.com/docs/cd/E15357_01/coh.360/e15723/api_querycache.htm Queering data in Cache].

= Implementing custom index =
Implementing custom index requires implemeting 3 classes.
 * [http://download.oracle.com/docs/cd/E15357_01/coh.360/e15725/com/tangosol/util/extractor/IndexAwareExtractor.html IndexAwareExtractor] is responsible for creation of index.
 * [http://download.oracle.com/docs/cd/E15357_01/coh.360/e15725/com/tangosol/util/MapIndex.html MapIndex] implementation is core of your custom index; Coherence will notify it about changes in stored objects.
 * [http://download.oracle.com/docs/cd/E15357_01/coh.360/e15725/com/tangosol/util/filter/IndexAwareFilter.html IndexAwareFilter] to use own index implementation you should create own filter (because standard filters are not aware about your custom index).

In Coherence [http://download.oracle.com/docs/cd/E15357_01/coh.360/e15725/com/tangosol/util/filter/IndexAwareFilter.html IndexAwareFilter] implementation is responsible to build own execution plan. Up on execution [http://download.oracle.com/docs/cd/E15357_01/coh.360/e15725/com/tangosol/util/filter/IndexAwareFilter.html IndexAwareFilter] is provided by collection of all indexes available for cache and it can choose which of them to use. Collection of indexes is stored as map there [http://download.oracle.com/docs/cd/E15357_01/coh.360/e15725/index.html?com/tangosol/util/extractor/IndexAwareExtractor.html ValueExtractor] serves as key and[http://download.oracle.com/docs/cd/E15357_01/coh.360/e15725/com/tangosol/util/MapIndex.html MapIndex] instance as value. So your custom filter should look for your custom[http://download.oracle.com/docs/cd/E15357_01/coh.360/e15725/com/tangosol/util/MapIndex.html MapIndex] using your custom [http://download.oracle.com/docs/cd/E15357_01/coh.360/e15725/com/tangosol/util/extractor/IndexAwareExtractor.html IndexAwareExtractor] as key (then it can downcast it and use your custom API instead of[http://download.oracle.com/docs/cd/E15357_01/coh.360/e15725/com/tangosol/util/MapIndex.html MapIndex]).

Custom index is created same way as standard index, by calling [http://download.oracle.com/docs/cd/E15357_01/coh.360/e15725/com/tangosol/util/QueryMap.html#addIndex_com_tangosol_util_ValueExtractor__boolean__java_util_Comparator_ addIndex(…)] on cache object. If you provide [http://download.oracle.com/docs/cd/E15357_01/coh.360/e15725/com/tangosol/util/extractor/IndexAwareExtractor.html IndexAwareExtractor] to [http://download.oracle.com/docs/cd/E15357_01/coh.360/e15725/com/tangosol/util/QueryMap.html#addIndex_com_tangosol_util_ValueExtractor__boolean__java_util_Comparator_ addIndex(…)] call, instead of creating standard [http://download.oracle.com/docs/cd/E15357_01/coh.360/e15725/index.html?com/tangosol/util/extractor/IndexAwareExtractor.html SimpleMapIndex], Coherence will use extractor to create index structure.

= Quirks =

Different Coherence cache types are supporting indexes. Most of them are operating with keys and value as with java objects, but distributed cache is different. Distributed cache is storing all objects in binary (serialized) form internally. Filter should operate with native representation of key used by cache. This means what[http://download.oracle.com/docs/cd/E15357_01/coh.360/e15725/com/tangosol/util/MapIndex.html MapIndex] should keep keys in [http://download.oracle.com/docs/cd/E15357_01/coh.360/e15725/com/tangosol/util/Binary.html Binary] form id it is used with distributed cache, but with object keys in other cases. This is not hard to implement but a bit awkward.

Coherence updates index entry by entry. Many sophisticated indexes (e.g. full text indexes) are very inefficient with small updates. So you probably will want to implement some kind of delayed index updates. This way you can collect a batch of updates and safe intermediate index rebuilds.